---
title: "taxitaxi"
<<<<<<< HEAD
author: "Kimia Khaffafzadeh Ahrabi, Amir Nejat, Tarek Halabi"
=======
author: "Kimia Khaffafzadeh Ahrabi, Amir Nejat, Tarek Halabi "
>>>>>>> 96e3861783974224e57cc79263ca9c1b21101ded
date: "5/17/2020"
output: html_document
---
Introduction: 

The dataset we have worked on belongs to the yellow taxi cabs that operate in New York. We chose October 2018 data to analyze and try to see if we can learn more about the commute new yorkers experience on a daily basis. 

We began by setting up and cleaning the data, only selecting our desired attributes.
The mentioned dataset had 8 million entries so we took a random sample of 2 million entries to work with. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gapminder)
library(broom)
library(ggplot2)
library(tidyverse)
library(stringr)
library(leaflet)
library(dplyr)
```

```{r cleaningdata}
url <- "https://s3.amazonaws.com/nyc-tlc/trip+data/yellow_tripdata_2018-10.csv"
taxi_tab <- read_csv(url)
head(taxi_tab)
```

```{r sampling}

taxi_tab <- taxi_tab %>%
  sample_n(2000000) %>%
  select(VendorID, tpep_pickup_datetime, tpep_dropoff_datetime, passenger_count, trip_distance, fare_amount, tip_amount, tolls_amount, PULocationID, DOLocationID)
head(taxi_tab)

```

The data set includes the drop off and pickup location. However, it has used location identification number to specify different zones in New York. We found a helpful table mentioning which borough of New York these IDs refer to. 

``` {r zonetab}
zoneurl <- "https://s3.amazonaws.com/nyc-tlc/misc/taxi+_zone_lookup.csv"
zone_tab <- read_csv(zoneurl)
head(zone_tab)
```

We now join our existing data set with this new table so that we can see to which burough of New York every ride entry belongs to. 

```{r mergezonenames}
  zone_df <- taxi_tab %>% full_join(zone_tab, by=c("PULocationID"="LocationID")) %>%
  select(-Zone, -service_zone)
zone_df

```


```{r graphzones}

split <- zone_df$tpep_dropoff_datetime
  split<-as.data.frame(split)
  split<- split%>%separate(split, c("date","time"), sep="\\s" )
  split$day <- weekdays(as.Date(split$date))
  zone_df$day <-split$day 
  
zone_df
```

The chunk of code below gets the count of rides happening on days of the week, filtering out NA days and Unknown boroughs so that we have a more consistent and clean look at our data. 

```{r getcount}
newdf <- zone_df %>%
  group_by(day,Borough) %>%
  summarise(count=n()) %>%
  filter(!is.na(day)) %>%
  filter(!(Borough=="Unknown"))
newdf
```

The number of rides in Manhatten is much higher than in the other buroughs. To be precise, out of our 2 million entry sample, 1.8 million belongs to this area and because of this significant difference, comparing counts of rides with other buroughs throughout the week causes our graph not to be that useful. We will basically see the trend in Manhattan clearly, but we will not be able to have any useful observation in regards to the other buroughs. Below we have singled out Manhattan rides. The graph is showing the number of rides that happen in this area (to be specific, picked up in this area) and how they change as the week goes by.

```{r sth}
man_df<- newdf %>%
  filter(Borough=="Manhattan") %>%
  group_by(day) %>% 
  summarise(rides=sum(count))

#Arranging weekdays so that they are in the correct order when visualizing our data

man_df$day<- factor(man_df$day, levels=c("Monday",
    "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday","Sunday"))
man_df<-man_df[order(man_df$day),]

man_df %>%
  ggplot(aes(x=day, y=rides, fill=day))+geom_bar(stat = "identity")+ggtitle(label = "Weekday Ride Number Comparison")+theme_minimal()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("Days")+ylab("Number of Rides")
man_df
           
```
What can be observed is that the number of rides is the highest on Wednesdays and lowest on Sundays and Saturdays. 

Another interesting observation is how the duration of rides might change throughout the week. Do newyorkers spend more time riding taxis on the weekend or do the majority use taxis to commute perhaps to and from work? 


#Hypothesis testing(day vs tipping):

Linear regression Model, We are trying to figure out the relationship between Day of the week and the Tip amount.For the linear regression model to actually be usable the mean should be very zero (or very close). In our case the mean is an extremely small value that it holds true.
null hypothesis: there is no relationship between them. Alternative hypothesis, is there is a relationship between tip amount and day. If the value of the intercept <0.05  it rejects the null hypothesis. If the value of p is greater > 0.05 it does not reject the null hypothesis, meaning that there is no relationship. Even though the p-value is less than 0.05 and the mean of the residuals is close to 0. through the graph and collected data, I do not see a linear regression relationship between these two variables. So I dont feel comfortable to use the Linear regression model because some of the assumptions are not met. 

Question 1:

Is there a general trend (e.g., increasing or decreasing) for Is there a relationship between weekend/weekday and tipping habits? Is this trend linear? 

Question 2: How would you describe the distribution of tibbing habits for each day? Is it skewed, or not? Unimodal or not? Symmetric around its center?

Question 3: What would a violin plot of residuals from the linear model in Question 3 vs. year look like? (Again, donâ€™t do the analysis yet, answer this intuitively)

Question 4: According to the assumptions of the linear regression model, what should that violin plot look like?

```{r hyptesting}

# Calendar Creation

  #adds the specific day of the week for each entity into taxi_tab
  split <- taxi_tab$tpep_dropoff_datetime
  split<-as.data.frame(split)
  split<- split%>%separate(split, c("date","time"), sep="\\s" )
  split$day <- weekdays(as.Date(split$date))
  taxi_tab$day <-split$day

  #Scatter Plot Days of the Week vs Dist. Travelled
  taxi_tab %>% ggplot(aes(x = day, y = trip_distance))+ geom_point() + labs(title = "Day of the Week Vs Distance Travelled")
 
  
  # box plot representing tip amounts compared to the day
  taxi_tab %>% ggplot(aes(x = day, y = tip_amount))+ geom_boxplot() + geom_smooth(method = lm)+ labs(title = "Day of the Week Vs Tip amount")
  
  Further_testing <- taxi_tab%>% group_by(day) %>% summarize(avg_fare = mean(fare_amount), avg_tip = mean(tip_amount), sum_fare = sum(fare_amount), sum_tip = sum(tip_amount), Count = n() )
  
  
  get_resid <- lm(tip_amount~day, data = taxi_tab)
  #checking the mean of the residuals
  mean(get_resid$residuals)
  
  get_resid_tidy <- get_resid %>% tidy() 
  
  augment_lm <- get_resid %>%augment()
  
  augment_lm %>% ggplot(aes(x=day, y =.resid)) +geom_violin() + geom_smooth(method = lm)+ labs(title = "Residuals vs year", x ="day", y = "residual")
  
  get_resid_tidy %>% knitr :: kable()

  augment_lm %>% ggplot(aes(x =factor(.fitted), y =.resid)) +geom_violin() + geom_smooth()+ labs(title = "Residuals vs fitted", x =" fitted", y = "residual")
  
 split2 <- taxi_tab$tpep_pickup_datetime
 split2 <- taxi_tab$tpep_dropoff_datetime
 split2<-as.data.frame(split2)
 split2$pickup <- taxi_tab$tpep_pickup_datetime
 split2 <- split2%>%separate(split2, c("date_drop","time_drop"), sep="\\s" )
 split2 <- split2%>%separate(pickup, c("date_pickup","time_pickup"), sep="\\s" )
 split2$drop_in_mins <- 60 * 24 * as.numeric(times(split2$time_drop))
 split2$pickup_in_mins <- 60 * 24 * as.numeric(times(split2$time_pickup))
split2$trip_duration <- split2$drop_in_mins - split2$pickup_in_mins
 taxi_tab$trip_duration <- split2$trip_duration
  
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
